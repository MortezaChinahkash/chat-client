<ion-app>
  <ion-header *ngIf="loggedIn">
    <ion-toolbar color="primary">
      <ion-title>Messenger â€“ {{ me }}</ion-title>
      <ion-button slot="end" fill="clear" (click)="logout()">Logout</ion-button>
    </ion-toolbar>
  </ion-header>

  <ion-content fullscreen>
    <!-- LOGIN / REGISTER -->
    <div *ngIf="!loggedIn" class="auth-container">
      <h2>{{ registerMode ? 'Registrieren' : 'Login' }}</h2>

      <ion-item>
        <ion-label position="stacked">Benutzername</ion-label>
        <ion-input [(ngModel)]="me"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Passwort</ion-label>
        <ion-input [(ngModel)]="password" type="password"></ion-input>
      </ion-item>

      <ion-button expand="block" [disabled]="loading" (click)="registerMode ? register() : login()">
        {{ registerMode ? 'Account erstellen' : 'Einloggen' }}
      </ion-button>

      <ion-button expand="block" fill="clear" (click)="registerMode = !registerMode">
        {{ registerMode ? 'Schon ein Konto? Jetzt einloggen' : 'Noch kein Konto? Jetzt registrieren' }}
      </ion-button>

      <div *ngIf="error" style="color:#c00; margin-top:8px;">{{ error }}</div>
    </div>

    <!-- CHAT -->
    <div *ngIf="loggedIn" class="chat-container">
      <div class="peer-select">
        <ion-item>
          <ion-label position="stacked">Chat-Partner</ion-label>
        <ion-input [(ngModel)]="peer" placeholder="z. B. alice / bob"></ion-input>
        </ion-item>
        <ion-button expand="block" (click)="join()">Beitreten</ion-button>
      </div>

      <div class="chat-feed">
        <div *ngFor="let m of feed" class="msg" [class.me]="m.from === me">
          <div class="bubble">
            <strong>{{ m.from }}:</strong> {{ m.text }}
            <div style="font-size: 0.7em; color: gray">{{ m.ts | date:'shortTime' }}</div>
          </div>
        </div>
      </div>

      <div class="msg-input">
        <ion-input [(ngModel)]="msg" placeholder="Nachricht schreiben..." (keyup.enter)="send()"></ion-input>
        <ion-button (click)="send()">Senden</ion-button>
      </div>

      <div *ngIf="error" style="color:#c00; margin-top:8px;">{{ error }}</div>
    </div>
  </ion-content>
</ion-app>
